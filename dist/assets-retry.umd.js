!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).assetsRetry=e()}(this,function(){"use strict";function i(t){return t}function a(){}function r(t,e){try{return"function"==typeof t[e]}catch(t){return!1}}function c(t){return Array.isArray(t)?t.reduce(function(t,e,n,r){return t[e]=r[(n+1)%r.length],t},{}):t}function y(e,t){return Object.keys(t).filter(function(t){return-1<e.indexOf(t)}).sort(function(t,e){return e.length-t.length})[0]}var e,g="retryTimes",m="succeeded",b="failed",E="maxRetryCount",O="onRetry",f="onSuccess",s="onFail",j="domain",d="_assetsRetryScript",p="_assetsRetryOnerror",l="script",w="data-assets-retry-hooked",S="data-retry-id",u=window,A=window.document,n=u.HTMLElement,k=u.HTMLScriptElement,v=u.HTMLStyleElement,R=u.HTMLLinkElement,x=u.HTMLImageElement,o=Object.prototype.hasOwnProperty,L=function(t,e,n){var r=t.indexOf(e);return-1===r?t:t.substring(0,r)+n+t.substring(r+e.length)},T=function(t){return[].slice.call(t)},_=function(e,t,n){if(void 0===n&&(n=a),"loading"!==A.readyState||/Edge|MSIE|rv:/i.test(navigator.userAgent)){var r=A.createElement(l);Object.keys(k.prototype).forEach(function(t){if("src"!==t&&e[t]&&"object"!=typeof e[t])try{r[t]=e[t]}catch(t){}}),r.src=t,r.onload=e.onload,r.onerror=e.onerror,r.setAttribute(S,I());var o=e.getAttribute("nonce");o&&r.setAttribute("nonce",o),A.getElementsByTagName("head")[0].appendChild(r)}else{var i=I(),c=e.outerHTML.replace(/data-retry-id="[^"]+"/,"").replace(/src=(?:"[^"]+"|.+)([ >])/,S+"="+i+' src="'+t+'"$1');A.write(c);var u=A.querySelector("script["+S+'="'+i+'"]');u&&(u.onload=n)}},M=function(e){try{return e.rules}catch(t){try{return e.cssRules}catch(t){return null}}},N=function(e,t,n){var r=A.createElement("link");Object.keys(R.prototype).forEach(function(t){if("href"!==t&&e[t]&&"object"!=typeof e[t])try{r[t]=e[t]}catch(t){}}),r.href=t,r.onload=n,r.setAttribute(S,I()),A.getElementsByTagName("head")[0].appendChild(r)},H=function(t){return t?t instanceof n?[t.nodeName,t.src,t.href,t.getAttribute(S)].join(";"):"not_supported":"null"},I=function(){return Math.random().toString(36).slice(2)},P=function(t){return t instanceof k||t instanceof x?t.src:t instanceof R?t.href:null},h={},C=function(t,e){var n,r=B(t,e),o=r[0],i=r[1];return o?(h[o]=h[o]||((n={})[g]=0,n[b]=[],n[m]=[],n),[i,h[o]]):[]},B=function(t,e){var n,r,o=y(t,e);return o?[(r=o,(n=t).substr(n.indexOf(r)+r.length,n.length)),o]:["",""]};try{e=function(t){for(var e=Object.getPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__},n=Object.keys(t);e(t);)n=n.concat(Object.keys(e(t))),t=e(t);return n.filter(function(t){return"constructor"!==t})}(k.prototype)}catch(t){}function F(a,t){var f=t[E],s=c(t[j]),l=t[O];return e.reduce(function(t,e){var n=r(k.prototype,e);return t[e]=n?{value:function(){return a[d][e].apply(a[d],arguments)}}:{set:function(o){return"onerror"===e?(a[p]=o,void(a[d].onerror=function(r){r.stopPropagation&&r.stopPropagation();function t(){return t=a[p],e=a[d],n=r,"function"!=typeof t?null:t.call(e,n);var t,e,n}var e=a[d].src,n=C(e,s),o=n[0],i=n[1];if(!o||!i)return t();var c=L(e,o,s[o]),u=l(c,e,i);if(null===u)return t();if("string"!=typeof u)throw new Error("a string should be returned in `onRetry` function");i[g]<=f?_(a[d],u):t()})):"onload"===e?(a._assetsRetryOnload=o,void(a[d].onload=function(t){var e=a[d].src,n=C(e,s),r=(n[0],n[1]);r&&-1===r[b].indexOf(e)&&r[m].push(e),o&&!o._called&&(o._called=!0,o.call(a[d],t))})):void(a[d][e]=o)},get:function(){return a[d][e]}},t},{})}var $=function(n){var r=A.createElement;A.createElement=function(t,e){return t===l?function(t,e){var n;t.setAttribute(w,"true");var r=((n={})[d]=t,n[p]=a,n),o=F(r,e);return Object.defineProperties(r,o),r}(r.call(A,l),n):r.call(A,t,e)},A.createElement.toString=function(){return"function createElement() { [native code] }"}},q=function(n){Object.keys(n).filter(function(t){return r(n,t)}).forEach(function(t){var e=n[t];n[t]=function(){var t=[].slice.call(arguments).map(function(t){return t&&o.call(t,d)?t[d]:t});return e.apply(this,t)},/^\w+$/.test(t)&&(n[t].toString=new Function("return 'function "+t+"() { [native code] }'"))})};var z={};function Z(y){function c(t){if(t){var e=t.target||t.srcElement,n=P(e);if(n){var r=C(n,h),o=r[0],i=r[1];if(i&&o){i[g]++,i[b].push(n);var c=i[g]>y[E];if(c){var u=B(n,h)[0];v(u)}if(h[o]&&!c){var a=h[o],f=L(n,o,a),s=p(f,n,i);if(null!==s){if("string"!=typeof s)throw new Error("a string should be returned in `onRetry` function");var l=H(e);if(!z[l]){z[l]=!0;var d=function(){i[m].push(s)};e instanceof k&&!e.getAttribute(w)&&e.src?_(e,s,d):e instanceof R&&e.href?N(e,s,d):e instanceof x&&e.src&&(e.setAttribute(S,I()),e.src=s,e.onload=d)}}}}}}}var p=y[O],u=y[f],v=y[s],h=y[j];A.addEventListener("error",c,!0),A.addEventListener("load",function(t){if(t){var e=t.target||t.srcElement,n=P(e);if(n){if(e.getAttribute(S)){var r=B(n,h)[0];u(r)}if(e instanceof R)if(A.styleSheets){var o=T(A.styleSheets).filter(function(t){return t.href===e.href})[0],i=M(o);null!==i&&0===i.length&&c(t)}}}},!0)}function D(t,e,n,r,o){var i=o[j],c=o[O],u=e.style&&e.style[t];if(u&&!/^url\(["']?data:/.test(u)){var a=u.match(/^url\(["']?(.+?)["']?\)/)||[],f=a[1];if(f){var s=y(f,i);if(s&&i[s]){var l=Object.keys(i).map(function(t){var e=L(f,s,t);return'url("'+c(e,f,null)+'")'}).join(","),d=e.selectorText+"{ "+t.replace(/([a-z])([A-Z])/g,function(t,e,n){return e+"-"+n.toLowerCase()})+": "+l+" !important; }";try{n.insertRule(d,r.length)}catch(t){n.insertRule(d,0)}}}}}var G={},J=[],K=function(t,o){var i=["backgroundImage","borderImage","listStyleImage"];t.forEach(function(n){var t=M(n);if(null!==t){var r=T(t);r.forEach(function(e){i.forEach(function(t){D(t,e,n,r,o)})}),n.href&&(G[n.href]=!0),n.ownerNode instanceof v&&J.push(n.ownerNode)}})},Q=function(t,n){return T(t).filter(function(t){if(!M(t))return!1;if(t.href)return!G[t.href]&&!!y(t.href,n);var e=t.ownerNode;return!(e instanceof v&&-1<J.indexOf(e))})};return function(t){var e;void 0===t&&(t={});try{if("object"!=typeof t[j])throw new Error("opts.domain cannot be non-object.");var n=[E,O,f,s,j],r=Object.keys(t).filter(function(t){return-1===n.indexOf(t)});if(0<r.length)throw new Error("option name: "+r.join(", ")+" is not valid.");var o=((e={})[E]=t[E]||3,e[O]=t[O]||i,e[f]=t[f]||a,e[s]=t[s]||a,e[j]=c(t[j]),e);return $(o),"undefined"!=typeof Node&&q(Node.prototype),"undefined"!=typeof Element&&q(Element.prototype),Z(o),function(e){var t=A.styleSheets,n=e[j];if(!t)return;setInterval(function(){var t=Q(A.styleSheets,n);0<t.length&&K(t,e)},250)}(o),h}catch(t){u.console&&console.error("[assetsRetry] error captured",t)}}});
//# sourceMappingURL=assets-retry.umd.js.map

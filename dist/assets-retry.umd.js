!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).assetsRetry=e()}(this,function(){"use strict";function i(t){return t}function u(){}function r(t,e){try{return"function"==typeof t[e]}catch(t){return!1}}function c(t){return Array.isArray(t)?t.reduce(function(t,e,n,r){return t[e]=r[(n+1)%r.length],t},{}):t}function p(e,t){return Object.keys(t).filter(function(t){return-1<e.indexOf(t)}).sort(function(t,e){return e.length-t.length})[0]}var e,m="retryTimes",g="succeeded",E="failed",b="maxRetryCount",O="onRetry",f="onSuccess",l="onFail",L="domain",d="_$assetsRetryScript",y="_$assetsRetryOnerror",s="script",j="data-assets-retry-hooked",w="data-retry-id",a=window,S=window.document,o=Object.prototype.hasOwnProperty,T=function(t,e,n){var r=t.indexOf(e);return-1===r?t:t.substring(0,r)+n+t.substring(r+e.length)},M=function(t){return[].slice.call(t)},k=function(e,t,n){if(void 0===n&&(n=u),"loading"!==S.readyState||/Edge|MSIE|rv:/i.test(navigator.userAgent)){var r=S.createElement(s);Object.keys(HTMLScriptElement.prototype).forEach(function(t){if("src"!==t&&e[t]&&"object"!=typeof e[t])try{r[t]=e[t]}catch(t){}}),r.src=t,r.onload=e.onload,r.onerror=e.onerror,r.setAttribute(w,x());var o=e.getAttribute("nonce");o&&r.setAttribute("nonce",o),S.getElementsByTagName("head")[0].appendChild(r)}else{var i=x(),c=e.outerHTML.replace(/data-retry-id="[^"]+"/,"").replace(/src=(?:"[^"]+"|.+)([ >])/,w+"="+i+' src="'+t+'"$1');S.write(c);var a=S.querySelector("script["+w+'="'+i+'"]');a&&(a.onload=n)}},H=function(e){try{return e.rules}catch(t){try{return e.cssRules}catch(t){return null}}},A=function(e,t,n){var r=S.createElement("link");Object.keys(HTMLLinkElement.prototype).forEach(function(t){if("href"!==t&&e[t]&&"object"!=typeof e[t])try{r[t]=e[t]}catch(t){}}),r.href=t,r.onload=n,r.setAttribute(w,x()),S.getElementsByTagName("head")[0].appendChild(r)},R=function(t){return t?t instanceof HTMLElement?[t.nodeName,t.src,t.href,t.getAttribute(w)].join(";"):"not_supported":"null"},x=function(){return Math.random().toString(36).slice(2)},_=function(t){return t instanceof HTMLScriptElement||t instanceof HTMLImageElement?t.src:t instanceof HTMLLinkElement?t.href:null},v={},N=function(t,e){var n,r=I(t,e),o=r[0],i=r[1];return o?(v[o]=v[o]||((n={})[m]=0,n[E]=[],n[g]=[],n),[i,v[o]]):[]},I=function(t,e){var n,r,o=p(t,e);return o?[(r=o,(n=t).substr(n.indexOf(r)+r.length,n.length)),o]:["",""]};try{e=function(t){for(var e=Object.getPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__},n=Object.keys(t);e(t);)n=n.concat(Object.keys(e(t))),t=e(t);return n.filter(function(t){return"constructor"!==t})}(HTMLScriptElement.prototype)}catch(t){}function h(u,t){var f=t[b],l=c(t[L]),s=t[O];return e.reduce(function(t,e){var n=r(HTMLScriptElement.prototype,e);return t[e]=n?{value:function(){return u[d][e].apply(u[d],arguments)}}:{set:function(o){return"onerror"===e?(u[y]=o,void(u[d].onerror=function(r){r.stopPropagation&&r.stopPropagation();function t(){return t=u[y],e=u[d],n=r,"function"!=typeof t?null:t.call(e,n);var t,e,n}var e=u[d].src,n=N(e,l),o=n[0],i=n[1];if(!o||!i)return t();var c=T(e,o,l[o]),a=s(c,e,i);if(null===a)return t();if("string"!=typeof a)throw new Error("a string should be returned in `onRetry` function");i[m]<=f?k(u[d],a):t()})):"onload"===e?(u._$assetsRetryOnload=o,void(u[d].onload=function(t){var e=u[d].src,n=N(e,l),r=(n[0],n[1]);r&&-1===r[E].indexOf(e)&&r[g].push(e),o&&!o._called&&(o._called=!0,o.call(u[d],t))})):void(u[d][e]=o)},get:function(){return u[d][e]}},t},{})}var P=function(n){var r=S.createElement;S.createElement=function(t,e){return t===s?function(t,e){var n;t.setAttribute(j,"true");var r=((n={})[d]=t,n[y]=u,n),o=h(r,e);return Object.defineProperties(r,o),r}(r.call(S,s),n):r.call(S,t,e)},S.createElement.toString=function(){return"function createElement() { [native code] }"}},$=function(n){Object.keys(n).filter(function(t){return r(n,t)}).forEach(function(t){var e=n[t];n[t]=function(){var t=[].slice.call(arguments).map(function(t){return t&&o.call(t,d)?t[d]:t});return e.apply(this,t)},/^\w+$/.test(t)&&(n[t].toString=new Function("return 'function "+t+"() { [native code] }'"))})};var C={};function B(p){function c(t){if(t){var e=t.target||t.srcElement,n=_(e);if(n){var r=N(n,h),o=r[0],i=r[1];if(i&&o){i[m]++,i[E].push(n);var c=i[m]>p[b];if(c){var a=I(n,h)[0];v(a)}if(h[o]&&!c){var u=h[o],f=T(n,o,u),l=y(f,n,i);if(null!==l){if("string"!=typeof l)throw new Error("a string should be returned in `onRetry` function");var s=R(e);if(!C[s]){C[s]=!0;var d=function(){i[g].push(l)};e instanceof HTMLScriptElement&&!e.getAttribute(j)&&e.src?k(e,l,d):e instanceof HTMLLinkElement&&e.href?A(e,l,d):e instanceof HTMLImageElement&&e.src&&(e.setAttribute(w,x()),e.src=l,e.onload=d)}}}}}}}var y=p[O],a=p[f],v=p[l],h=p[L];S.addEventListener("error",c,!0),S.addEventListener("load",function(t){if(t){var e=t.target||t.srcElement,n=_(e);if(n){if(e.getAttribute(w)){var r=I(n,h)[0];a(r)}if(e instanceof HTMLLinkElement)if(S.styleSheets){var o=M(S.styleSheets).filter(function(t){return t.href===e.href})[0],i=H(o);null!==i&&0===i.length&&c(t)}}}},!0)}function F(t,e,n,r,o){var i=o[L],c=o[O],a=e.style&&e.style[t];if(a&&!/^url\(["']?data:/.test(a)){var u=a.match(/^url\(["']?(.+?)["']?\)/)||[],f=u[1];if(f){var l=p(f,i);if(l&&i[l]){var s=Object.keys(i).map(function(t){var e=T(f,l,t);return'url("'+c(e,f,null)+'")'}).join(","),d=e.selectorText+"{ "+t.replace(/([a-z])([A-Z])/g,function(t,e,n){return e+"-"+n.toLowerCase()})+": "+s+" !important; }";try{n.insertRule(d,r.length)}catch(t){n.insertRule(d,0)}}}}}var q={},z=[],Z=function(t,o){var i=["backgroundImage","borderImage","listStyleImage"];t.forEach(function(n){var t=H(n);if(null!==t){var r=M(t);r.forEach(function(e){i.forEach(function(t){F(t,e,n,r,o)})}),n.href&&(q[n.href]=!0),n.ownerNode instanceof HTMLStyleElement&&z.push(n.ownerNode)}})},D=function(t,n){return M(t).filter(function(t){if(!H(t))return!1;if(t.href)return!q[t.href]&&!!p(t.href,n);var e=t.ownerNode;return!(e instanceof HTMLStyleElement&&-1<z.indexOf(e))})};return function(t){var e;void 0===t&&(t={});try{if("object"!=typeof t[L])throw new Error("opts.domain cannot be non-object.");var n=[b,O,f,l,L],r=Object.keys(t).filter(function(t){return-1===n.indexOf(t)});if(0<r.length)throw new Error("option name: "+r.join(", ")+" is not valid.");var o=((e={})[b]=t[b]||3,e[O]=t[O]||i,e[f]=t[f]||u,e[l]=t[l]||u,e[L]=c(t[L]),e);return P(o),"undefined"!=typeof Node&&$(Node.prototype),"undefined"!=typeof Element&&$(Element.prototype),B(o),function(e){var t=S.styleSheets,n=e[L];if(!t)return;setInterval(function(){var t=D(S.styleSheets,n);0<t.length&&Z(t,e)},250)}(o),v}catch(t){a.console&&console.error("[assetsRetry] error captured",t)}}});
//# sourceMappingURL=assets-retry.umd.js.map
